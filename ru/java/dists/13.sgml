<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" [
<!ENTITY base CDATA "../..">
<!ENTITY date "$FreeBSD$">
<!ENTITY title "Проект FreeBSD Java: JDK 1.3">
<!ENTITY % includes SYSTEM "../../includes.sgml"> %includes;
]>
<!-- $FreeBSD$ -->
<!-- The FreeBSD Russian Documentation Project -->
<!-- $FreeBSDru: frdp/www/ru/java/dists/13.sgml,v 1.5 2000/10/11 16:16:15 phantom Exp $ -->
<!-- Original revision: 1.4 -->

<html>
  &header;

  <table border="0">
  <tr>
    <td>
      <P><B>15 сентября 2000:</B>
	<a href="mailto:gallatin@cs.duke.edu">Эндрю Галлатин</a> (Andrew
        Gallatin) и <a href="mailto:sean@stat.Duke.EDU">Шин О'Коннелл</a>
        (Sean O'Connell) работают над
	получением рабочего пакета JDK 1.3 фирмы IBM.  Чтобы он заработал в
	вашей системе, вам нужно применить патчи к некоторым исходным текстам
	FreeBSD.  Они предоставили патчи в зависимости от вашей версии:
	<br> <a href="http://www.cs.duke.edu/~gallatin/linux_sa_siginfo/4.0-release.diff">
	4.0-RELEASE</a>
	<br><a href="http://people.freebsd.org/~patrick/ibmjdk/linux.patch2">
	4.0-STABLE</a>
	<br><a href="http://www.cs.duke.edu/~gallatin/linux_sa_siginfo/diff">
	-CURRENT</a> (до SMPng)

      <P>Процитируем сообщение от Дрю:<br>
        <pre>
Я наконец-то добился работы jdk 1.3 фирмы IBM. Хотя сильно я ещё её не
тестировал, похоже, что AWT работает.

Вот обновлённый набор патчей для версии -current до SMPng.  Набор патчей
делает следующее:

- меняет значение MINSIGSTKSZ с 8192  на 2048
- реализует linux_rt_sendsig() & linux_rt_sigreturn()
- реализует пользовательский код sigtramp для linux_rt_sigreturn()
- реализует linux_to_bsd_sigaltstack & bsd_to_linux_sigaltstack() для
	исправления ошибки в linux_sigaltstack & во избежание множества
	вставок в linux_rt_sigreturn().  Также исправлено появление сообщения
	"Java HotSpot(TM) Client VM warning: cannot uninstall alt signal stack",
	которое было замечено с JDK 1.3 фирмы Sun.
- изменен флаг MAP_STACK на MAP_ANON для отображаемых областей памяти
	LINUX_MAP_GROWSDOWN. Это был последний шаг для того, чтобы это
	работало. Найдутся ли гуру VM, чтобы поговорить об этом? Похоже, что
	что-то не так с растущими стеками в нитях linux[*]

Патчи находятся здесь: http://www.cs.duke.edu/~gallatin/linux_sa_siginfo/diff

[*]"Проблема" в эвристических методах, применяемых в функции
vm_map_growstack() для определения того, является ли стек частью стека
основного процесса. Сейчас мы используем:

	is_procstack = addr >= (vm_offset_t)vm->vm_maxsaddr;

где vm->vm_maxsaddr получается из exec_new_vmspace():
	vmspace->vm_maxsaddr = (char *)USRSTACK - MAXSSIZ;

Главная нить JDK фирмы IBM уменьшает размер его стека до rlim_cur=2040*1024.
Затем она создает стеки для своих нитей в адресах, которые превышают
vm_maxsaddr, но меньше, чем текущая нижняя граница стека основного процесса,
как определено в p->p_rlimit[RLIMIT_STACK].rlim_cur. Как только нить пытается
обратиться к чему-либо, для чего требуется увеличения области, она погибает.
	</pre>

      <P>А теперь письмо от Шина:
	<pre>
Я на скорую руку засинхронизировался с изменениями, которые выполнил Эндрю
Галлатин для того, чтобы заработал Java SDK от IBM.  Я смог запустить
appletviewer с одним из демонстрационных приложений и оно работало.  Больше
сказать ничего не могу.

Все патчи сделаны относительно /usr/src (или /, потому что все они выполнены
в каталоге sys )

Большинство исправлений сделано в файлах из /sys/i386/linux.  Вы должны
смочь применить патч; перейдите в каталог /sys/modules/linux; наберите
make; kldunload linux; наберите make install; потом kldload linux

Есть ещё одно изменение, которое задаёт значение MINSIGSTKSZ равным 2048
в sys/sys/signal.h .. для актуализации этого изменения требуется перекомпиляция
ядра.
        </pre>

      <p><b>18 июля 2000:</B>
        <a href="ernst@jollem.com">Эрнст де Хаан</a> (Ernst de Haan) выполнил
        некоторую работу, что позволило запускать Linux JDK 1.3.0b9 фирмы Sun в
        4.0-STABLE.  Файл .java_wrapper находится по адресу <a
        href="http://people.freebsd.org/~patrick/sunjdk/java_wrapper">
        здесь</a>.  (Не забудьте переименовать его в .java_wrapper)

      <p>Вот что пишет Эрнст:
        <pre>
Ещё один совет: Измените файл jre/lib/jvm.cfg и переместите последнюю строку
наверх.  Тогда вы получите:

   -classic
   -hotspot
   -server

Кстати, я получил следующее предупреждение при запуске Swing-приложения:

   Warning: Cannot convert string "MetaCtrl&lt;Key&gt;Insert" to type VirtualBinding

Ernst

Ernst de Haan пишет:
> Hi folkz,
>
> Мне удалось запустить Sun JDK 1.3.0 for Linux, beta 9 на моей системе FreeBSD
> 4.0-STABLE. Работает весьма хорошо.
>
> java -version выдаёт следующее:
>
>    bash-2.04$ java -version
>    expr: syntax error
>    java version "1.3.0beta_refresh"
>    Java(TM) 2 Runtime Environment, Standard Edition (build 1.3.0beta_refresh-b09)
>    Classic VM (build 1.3.0beta_refresh-b09, green threads, nojit)
>
> Первая строка о синтаксической ошибке является маленькой проблемой с файлом
> .java_wrapper, но видимо, она несерьёзная. Я выполнил некоторые модификации
> в скрипте .java_wrapper, чтобы всё работало на моей системе. Прилагаю
> версию, которую я использую.
>
> Подробно я ещё не тестировал, однако попробовал запустить одно
> Swing-приложение. Я заметил некоторые отличия в шрифтах, хотя похоже, что
> всё работает достаточно хорошо и быстро :)
>
> Ого, скоро FreeBSD станет платформой с наибольшим количеством работающих
> на ней пакетов JDK, как только на ней заработает WINE, мы сможем запустить
> пакеты JDK ещё и для Windows, и ещё написать эмулятор AS/400, и ещё... и
> ещё... ;-)
>
> Ernst
>
> P.S.  Спасибо Виктору Саламану (Victor Salaman), который указал мне
>       правильное направление. Он достаточно давно работает с Sun JDK 1.3
>       for Linux.
        </pre>

      <P><B>29 января 2000:</B>
        Работа над портированием JDK 1.3 ещё не началась.  И до тех пор, пока
        не будет выпущен релиз JDK 1.2, работа над JDK 1.3 проводиться не
        будет.
    </td>
  </tr>
  </table>

  &footer;
</body>
</html>
